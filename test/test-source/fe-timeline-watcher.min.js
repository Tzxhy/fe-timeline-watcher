/* 这是一个测试哈*/
var __FE_TIMELINE_WATCHER__=function(){"use strict";var a,b=function(){};(function(a){a[a.FIRST_PAGE=0]="FIRST_PAGE",a[a.LOAD_RESOURCE=1]="LOAD_RESOURCE",a[a.ERROR=2]="ERROR"})(a||(a={}));var c=function(){function c(d,e,f,g){void 0===d&&(d="//touch.tzx.qunar.com/watcher"),void 0===e&&(e=!0),void 0===f&&(f=!0),void 0===g&&(g=!0);var h=this;if(c.watcherUrl=d,!(window.performance&&window.performance.getEntries))return console.info("Your browser doesn't support Performance API. We cann't record any data. See you."),null;if(window.PerformanceObserver){this.getLatestEntries=this.getLatestEntries.bind(this);var i=new PerformanceObserver(this.getLatestEntries);i.observe({entryTypes:["resource"]})}if(this._sendType=a.FIRST_PAGE,this._hasReadIndex=0,this._messageBuf=[],this.doOnce(),console.log("document.readyState: ",document.readyState),"complete"!==document.readyState){var j=window.onload||b;window.onload=function(a){return setTimeout(function(){var a;a=c.getFirstEntries(),h._entriesPageLoad=a[0],h._entriesResource=a[1],console.log("this._entriesPageLoad: ",h._entriesPageLoad),h._hasReadIndex=0,h.sendBuf()},0),j.bind(a).call(a)}}else this.sendBuf()}return c.getFirstEntries=function(){return[performance.getEntriesByType("navigation"),performance.getEntriesByType("resource")]},c.prototype.doOnce=function(){var c,d=this,e={};c=window.navigator,e.platform=c.platform,e.userAgent=c.userAgent,this.browserInfo=e;var f=window.onerror||b;window.onerror=function(b,c,e,g,h){var i=b.toLowerCase();if(-1<i.indexOf("script error"))console.log("Script Error: See Browser Console for Detail");else{var j=["Message: "+b,"URL: "+c,"Line: "+e,"Column: "+g,"Error object: "+JSON.stringify(h)].join("\n");d._errorMsg=j,d._sendType=a.ERROR,d.sendBuf()}return f(b,c,e,g,h)}},c.compute=function(a){console.log("performanceResourceTiming: ",a);var b=a.domainLookupStart,d=a.domainLookupEnd,e=a.duration,f=a.name,g=a.responseStart,h=a.responseEnd;e=c.getShortS(""+e),console.log("duration: ",e);var i=c.getShortS(""+(d-b)),j=c.getShortS(""+(h-g));return{dnsTime:i,duration:e,url:f,responseTime:j}},c.prototype.getLatestEntries=function(b){var d,e=this;clearTimeout(c.updateTimer);var f=b.getEntriesByType("resource");f=f.filter(function(a){return-1===a.name.indexOf(c.watcherUrl)}),0<f.length&&((d=c._tempResource).push.apply(d,f),c.updateTimer=setTimeout(function(){e._entriesResource=c._tempResource,c._tempResource=[],e._sendType=a.LOAD_RESOURCE,e.sendBuf()},1e3))},c.getShortS=function(a){return a.slice(0,8)},c.prototype.sendBuf=function(){var b={};switch(this._sendType){case a.FIRST_PAGE:b.browserInfo=this.browserInfo,b.type=a.FIRST_PAGE,b.pageLoad=c.compute(this._entriesPageLoad[0]),b.resource=this._entriesResource.map(c.compute);break;case a.LOAD_RESOURCE:b.type=a.LOAD_RESOURCE,b.resource=this._entriesResource.map(c.compute);break;case a.ERROR:b.error=this._errorMsg,b.browserInfo=this.browserInfo,b.type=a.ERROR;break;default:}fetch(c.watcherUrl,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},credentials:"omit",body:JSON.stringify(b)})},c.start=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return new(c.bind.apply(c,[void 0].concat(a)))},c._tempResource=[],c}();return c}();
